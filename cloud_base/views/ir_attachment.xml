<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="ir_attachment_search_form_cloud_base" model="ir.ui.view">
        <field name="model">ir.attachment</field>
        <field name="priority">10000</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="clouds_folder_id"/>
                <field name="cloud_tag_ids" groups="cloud_base.group_cloud_base_tags"/>
                <field name="create_uid" string="Created by"/>
                <field name="mimetype" groups="base.group_no_one"/>
                <separator/>
                <filter name="synced_files" string="Synced" domain="[('cloud_key', '!=', False)]"/>
                <filter name="not_synced_files" string="Not Synced" domain="[('cloud_key', '=', False)]"/>
                <separator/>
                <filter name="my_documents_filter" string="My Files" domain="[('create_uid','=',uid)]"/>
                <separator/>
                <filter name="url_filter" string="URL" domain="[('type', '=', 'url')]"/>
                <filter name="binary_filter" string="Binary" domain="[('type', '=', 'binary')]"/>
            </search>
        </field>
    </record>
    <record id="ir_attachment_view_form_cloud_base" model="ir.ui.view">
        <field name="name">ir.attachment.form.cloud.base</field>
        <field name="model">ir.attachment</field>
        <field name="priority">10000</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <label for="name" class="oe_edit_only"/>
                    <h1>
                        <field name="name"/>
                    </h1>
                    <group>
                        <field name="clouds_folder_id"/>
                        <field name="cloud_tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" groups="cloud_base.group_cloud_base_tags"/>
                        <field name="type"/>
                        <field name="datas" filename="name" invisible="type == 'url'"/>
                        <field name="url" widget="url" invisible="type == 'binary'"/>
                        <field name="mimetype" groups="base.group_no_one"/>
                        <field name="file_size"/>
                    </group>
                    <group>
                        <group string="Attached To" groups="base.group_no_one">
                            <field name="res_model"/>
                            <field name="res_field"/>
                            <field name="res_id"/>
                            <field name="res_name"/>
                            <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                            <field name="public"/>
                        </group>
                        <group string="Sync Information" invisible="not cloud_key">
                            <field name="cloud_key" readonly="1"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    <record id="ir_attachment_view_kanban_cloud_base" model="ir.ui.view">
        <field name="name">ir.attachment.kanban.cloud.base</field>
        <field name="model">ir.attachment</field>
        <field name="priority">10000</field>
        <field name="arch" type="xml">
            <kanban js_class="cloud_base_kanban" highlight_color="color" group_create="0" group_delete="0" group_edit="0" archivable="0" quick_create="0">
                <field name="id"/>
                <field name="mimetype"/>
                <field name="type"/>
                <field name="cloud_key"/>
                <field name="url"/>
                <templates>
                    <t t-name="menu">
                        <t t-if="widget.editable"><a role="menuitem" type="open" class="dropdown-item">Open</a></t>
                        <field name="color" widget="kanban_color_picker"/>
                    </t>
                    <t t-name="card" class="flex-row">
                        <aside class="o_kanban_aside_full">
                            <div class="o_kanban_image jstr-kanban-cb-image">
                                <t t-set="webimage" t-value="new RegExp('image.*(gif|jpeg|jpg|png)').test(record.mimetype.value)"/>
                                <div t-if="(!webimage and record.type.raw_value != 'url') or (record.type.raw_value == 'url' and record.cloud_key.raw_value)" class="o_image o_image_thumbnail jstr-kanban-img-thumbnail" t-att-data-mimetype="record.mimetype.value"/>
                                <div t-elif="record.type.raw_value == 'url'" class="o_url_image fa fa-link fa-3x text-muted mt8" aria-label="Image is a link"/>
                                <img t-elif="webimage" width="56" height="56" t-attf-src="/web/image/#{record.id.raw_value}" alt="File" class="o_attachment_image"/>
                            </div>
                        </aside>
                        <main class="ps-2 ps-md-0">
                            <div class="mb-1">
                                <div class="jstr-pull-right jstr-kanban-select-box">
                                    <i class="fa fa-lg fa-square-o jstr-hide-mobile jstr-hide-tablet jstr-pull-right">
                                    </i>
                                    <i class="fa fa-lg fa-check-square-o jstr-hide-mobile jstr-hide-tablet jstr-pull-right">
                                    </i>
                                </div>
                                <strong class="jstr-overalyed">
                                    <field name="name" class="fw-bold fs-5"/>
                                </strong>
                                <div t-if="record.type.raw_value == 'url'" class="jstr-kanban-attachment-url mt4">
                                    <small t-att-title="record.url.raw_value"><a type="object" name="action_retrieve_url_window"><t t-out="record.url.raw_value"/></a></small>
                                </div>
                                <samp t-else="" class="text-muted"> </samp>
                                <field name="cloud_tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" groups="cloud_base.group_cloud_base_tags"/>
                                <div title="Folder" t-if="record.clouds_folder_id.raw_value">
                                    <i class="fa fa-folder"></i> <i><field name="clouds_folder_id"/></i>
                                </div>
                            </div>
                            <footer class="pt-1">
                                <div class="d-flex ms-auto gap-2">
                                    <a t-attf-href="/web/content/ir.attachment/#{record.id.raw_value}/datas?download=true" download="" t-attf-class="fa fa-lg mt4 #{record.type.raw_value == 'url' and record.cloud_key.raw_value and 'fa-cloud' or record.type.raw_value != 'url' and 'fa-download' or ''}" target="_blank" title="Download"/>
                                    <a t-attf-href="#{record.url.raw_value}" class="fa fa-lg fa-link mt4" target="_blank" title="Open" t-if="record.type.raw_value == 'url' and !record.cloud_key.raw_value"/>
                                    <span title="Created on" class="d-flex jstr-hide-mobile jstr-hide-tablet jstr-hide-under-1000 ml16">
                                        <field name="create_date" widget="date"/>
                                    </span>
                                    <field name="create_uid" widget="many2one_avatar_user" class="ms-auto jstr-hide-mobile jstr-hide-tablet jstr-hide-under-1000"/>
                                </div>
                            </footer>
                        </main>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <record id="ir_attachment_action" model="ir.actions.act_window">
        <field name="name">File Manager</field>
        <field name="path">cloud-file-manager</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">ir.attachment</field>
        <field name="view_mode">kanban,form</field>
        <field name="context">{
            "kanban_view_ref": "cloud_base.ir_attachment_view_kanban_cloud_base",
            "form_view_ref": "cloud_base.ir_attachment_view_form_cloud_base",
        }</field>
        <field name="domain">[("clouds_folder_id", "!=", False)]</field>
        <field name="search_view_id" ref="ir_attachment_search_form_cloud_base"/>
        <field name="groups_id" eval="[(4, ref('cloud_base.group_cloud_base_user'))]"/>
    </record>
    <record id="ir_attachment_view_form_simple_js_upload" model="ir.ui.view">
        <field name="name">ir.attachment.form.js.upload</field>
        <field name="model">ir.attachment</field>
        <field name="priority">20000</field>
        <field name="arch" type="xml">
            <form string="Attachments">
                <sheet>
                    <group>
                        <field name="datas" filename="name" required="1"/>
                        <field name="name" required="1"/>
                        <field name="mimetype" groups="base.group_no_one" invisible="1"/>
                        <field name="id" invisible="1"/>
                    </group>
              </sheet>
            </form>
        </field>
    </record>

</odoo>
